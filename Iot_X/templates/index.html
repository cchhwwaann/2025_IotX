<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì œìŠ¤ì²˜ ë ˆì‹œí”¼ë¶</title>
    <style>
        body {
            display: flex;
            margin: 0;
            font-family: Arial, sans-serif;
            height: 100vh;
            background-color: #f4f4f4;
        }
        .main-container {
            display: flex;
            width: 100%;
        }
        .recipe-list-area {
            flex: 1;
            background-color: #ffffff;
            padding: 20px;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            overflow-y: auto;
        }
        .recipe-content-area {
            flex: 1;
            background-color: #fff;
            padding: 20px;
            overflow-y: auto;
        }
        .side-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            background-color: #e9ecef;
        }
        .timer-container, .tool-container {
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin: 10px;
            border-radius: 8px;
        }
        .timer-container {
            background-color: #ffffff;
            flex: 1;
        }
        .tool-container {
            background-color: #ffffff;
            flex: 1;
        }
        h2 {
            color: #333;
            border-bottom: 2px solid #ccc;
            padding-bottom: 10px;
        }
        .recipe-list ul {
            list-style-type: none;
            padding: 0;
        }
        .recipe-list li {
            padding: 10px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            font-weight: bold;
        }
        .recipe-list li:hover {
            background-color: #f0f0f0;
        }
        .recipe-item {
            display: none;
        }
        .recipe-item.active {
            display: block;
        }
        .timer-display {
            font-size: 3em;
            text-align: center;
            margin: 20px 0;
            color: #555;
        }
        .timer-buttons {
            text-align: center;
        }
        .timer-buttons button, .convert-button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background-color: #007bff;
            color: white;
            transition: border 0.2s;
        }
        .timer-buttons button:hover, .convert-button:hover {
            background-color: #0056b3;
        }
        input, select {
            padding: 8px;
            margin: 5px;
            border-radius: 4px;
            border: 1px solid #ccc;
            width: calc(100% - 10px);
        }
        .highlight {
            border: 3px solid #28a745 !important;
        }
        #finger-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
        }
    </style>
</head>
<body>

<div class="main-container">

    <div class="recipe-list-area">
        <h2>ë ˆì‹œí”¼ ëª©ë¡</h2>
        <div class="recipe-list">
            <ul>
                <li onclick="showRecipe('chicken')">ë§¤ì½¤í•œ ë‹­ë³¶ìŒíƒ• ğŸŒ¶ï¸</li>
                <li onclick="showRecipe('pasta')">ì‰¬ìš´ í¬ë¦¼ íŒŒìŠ¤íƒ€ ğŸ</li>
                <li onclick="showRecipe('curry')">ê°„ë‹¨ ì¹´ë ˆë¼ì´ìŠ¤ ğŸ›</li>
            </ul>
        </div>
    </div>

    <div class="recipe-content-area">
        <div id="recipe-chicken" class="recipe-item active">
            <h3>ë§¤ì½¤í•œ ë‹­ë³¶ìŒíƒ• ë ˆì‹œí”¼ ğŸŒ¶ï¸</h3>
            <p><strong>ì¬ë£Œ:</strong> ë‹­ í•œ ë§ˆë¦¬, ê°ì 2ê°œ, ì–‘íŒŒ 1ê°œ, ë‹¹ê·¼ 1ê°œ, ê³ ì¶§ê°€ë£¨, ê°„ì¥, ì„¤íƒ•, ë§ˆëŠ˜</p>
            <p><strong>ìš”ë¦¬ ê³¼ì •:</strong></p>
            <ol>
                <li>ë‹­ì„ ê¹¨ë—ì´ ì”»ì–´ í•œì… í¬ê¸°ë¡œ ìë¥¸ë‹¤.</li>
                <li>ëƒ„ë¹„ì— ë¬¼ì„ ë„£ê³  ë‹­, ê°ì, ë‹¹ê·¼ì„ ë„£ê³  ë“ì¸ë‹¤.</li>
                <li>ì–‘ë…ì¥ì„ ë§Œë“¤ì–´ ë„£ê³  ì¤‘ë¶ˆì—ì„œ 20ë¶„ê°„ ë“ì¸ë‹¤.</li>
                <li>ì–‘íŒŒë¥¼ ë„£ê³  5ë¶„ ë” ë“ì´ë©´ ì™„ì„±!</li>
            </ol>
        </div>
        <div id="recipe-pasta" class="recipe-item">
            <h3>ì‰¬ìš´ í¬ë¦¼ íŒŒìŠ¤íƒ€ ë ˆì‹œí”¼ ğŸ</h3>
            <p><strong>ì¬ë£Œ:</strong> íŒŒìŠ¤íƒ€ ë©´ 200g, ìƒí¬ë¦¼ 200ml, ë² ì´ì»¨, ì–‘íŒŒ, ë§ˆëŠ˜</p>
            <p><strong>ìš”ë¦¬ ê³¼ì •:</strong></p>
            <ol>
                <li>ë“ëŠ” ë¬¼ì— ì†Œê¸ˆ ì•½ê°„ ë„£ê³  íŒŒìŠ¤íƒ€ ë©´ì„ ì‚¶ëŠ”ë‹¤. (ì•½ 8ë¶„)</li>
                <li>íŒ¬ì— ë² ì´ì»¨ê³¼ ì–‘íŒŒ, ë§ˆëŠ˜ì„ ë³¶ëŠ”ë‹¤.</li>
                <li>ìƒí¬ë¦¼ì„ ë¶“ê³  ë“ì´ë‹¤ê°€ ì‚¶ì€ ë©´ì„ ë„£ê³  ì„ëŠ”ë‹¤.</li>
                <li>ê°„ì„ ë§ì¶˜ í›„ ì ‘ì‹œì— ë‹´ì•„ ë§›ìˆê²Œ ë¨¹ëŠ”ë‹¤.</li>
            </ol>
        </div>
        <div id="recipe-curry" class="recipe-item">
            <h3>ê°„ë‹¨ ì¹´ë ˆë¼ì´ìŠ¤ ë ˆì‹œí”¼ ğŸ›</h3>
            <p><strong>ì¬ë£Œ:</strong> ì¹´ë ˆìš© ê³ ê¸°, ê°ì, ë‹¹ê·¼, ì–‘íŒŒ, ì¹´ë ˆ ê°€ë£¨</p>
            <p><strong>ìš”ë¦¬ ê³¼ì •:</strong></p>
            <ol>
                <li>ê³ ê¸°ì™€ ì±„ì†Œë¥¼ í•œì… í¬ê¸°ë¡œ ì¬ë‹¤.</li>
                <li>ëƒ„ë¹„ì— ê¸°ë¦„ì„ ë‘ë¥´ê³  ê³ ê¸°ì™€ ì±„ì†Œë¥¼ ë³¶ëŠ”ë‹¤.</li>
                <li>ë¬¼ì„ ë„£ê³  ë“ì´ë‹¤ê°€ ì±„ì†Œê°€ ìµìœ¼ë©´ ì¹´ë ˆ ê°€ë£¨ë¥¼ ë„£ëŠ”ë‹¤.</li>
                <li>ì˜ ì €ì–´ê°€ë©° ë“ì´ë‹¤ê°€ ê±¸ì­‰í•´ì§€ë©´ ë¶ˆì„ ëˆë‹¤.</li>
            </ol>
        </div>
    </div>

    <div class="side-area">

        <div class="timer-container">
            <h2>ìš”ë¦¬ íƒ€ì´ë¨¸</h2>
            <div class="timer-display" id="timer-display">00:00</div>
            <div class="timer-buttons">
                <button onclick="startTimer()">ì‹œì‘</button>
                <button onclick="stopTimer()">ì •ì§€</button>
                <button onclick="resetTimer()">ì´ˆê¸°í™”</button>
            </div>
            <input type="number" id="minutes" placeholder="ë¶„" style="width: calc(50% - 10px); float: left;">
            <input type="number" id="seconds" placeholder="ì´ˆ" style="width: calc(50% - 10px); float: right;">
        </div>

        <div class="tool-container">
            <h2>ë‹¨ìœ„ ë³€í™˜ê¸°</h2>
            <p>ì˜¨ë„ ë³€í™˜</p>
            <input type="number" id="celsius-input" placeholder="ì„­ì”¨ (Â°C)">
            <p>
                <button class="convert-button" onclick="convertTemperature('celsius')">í™”ì”¨ ë³€í™˜</button>
                <button class="convert-button" onclick="convertTemperature('fahrenheit')">ì„­ì”¨ ë³€í™˜</button>
            </p>
            <p id="temp-result" style="font-weight: bold;"></p>
        </div>
    </div>

</div>

<canvas id="finger-canvas"></canvas>

<script>
    // ----------------------------------------------------
    // *** ìº”ë²„ìŠ¤ì— ë¹¨ê°„ ì  í‘œì‹œ ê¸°ëŠ¥ ***
    // ----------------------------------------------------
    const canvas = document.getElementById('finger-canvas');
    const ctx = canvas.getContext('2d');

    function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    function drawFingerPoint(x, y) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.beginPath();
        ctx.arc(x, y, 10, 0, 2 * Math.PI);
        ctx.fillStyle = 'red';
        ctx.fill();
        ctx.lineWidth = 2;
        ctx.strokeStyle = '#fff';
        ctx.stroke();
    }

    // ----------------------------------------------------
    // *** ì œìŠ¤ì²˜ ì¸ì‹ ë° ë²„íŠ¼ ë§¤í•‘ ê´€ë ¨ ì½”ë“œ ***
    // ----------------------------------------------------
    let allButtons = [];
    let currentHighlightedButton = null;
    let pinchDetected = false;

    // showRecipe í•¨ìˆ˜
    function showRecipe(recipeId) {
        const allRecipeItems = document.querySelectorAll('.recipe-item');
        allRecipeItems.forEach(item => {
            item.classList.remove('active');
        });
        document.getElementById('recipe-' + recipeId).classList.add('active');
    }

    document.addEventListener('DOMContentLoaded', () => {
        showRecipe('chicken');
        allButtons = Array.from(document.querySelectorAll('.timer-buttons button, .convert-button, .recipe-list li'));
        
        setInterval(fetchFingerPosition, 100);
    });

    function fetchFingerPosition() {
        fetch('/get_finger_pos')
            .then(response => response.json())
            .then(data => {
                const fingerX = data.x * window.innerWidth;
                const fingerY = data.y * window.innerHeight;
                const isPinch = data.isPinch;

                if (!isNaN(fingerX) && !isNaN(fingerY)) {
                    drawFingerPoint(fingerX, fingerY);
                    const closestButton = findClosestButton(fingerX, fingerY);
                    highlightButton(closestButton);
                    handlePinchClick(closestButton, isPinch);
                }
            })
            .catch(error => console.error('Error fetching data:', error));
    }

    function findClosestButton(x, y) {
        let closestBtn = null;
        let minDistance = Infinity;

        allButtons.forEach(btn => {
            const rect = btn.getBoundingClientRect();
            const btnX = rect.left + rect.width / 2;
            const btnY = rect.top + rect.height / 2;
            
            const distance = Math.sqrt(Math.pow(btnX - x, 2) + Math.pow(btnY - y, 2));

            if (distance < minDistance) {
                minDistance = distance;
                closestBtn = btn;
            }
        });
        return closestBtn;
    }

    function highlightButton(button) {
        // ì´ì „ì— í•˜ì´ë¼ì´íŠ¸ëœ ë²„íŠ¼ì´ ìˆê³ , ê·¸ê²ƒì´ í˜„ì¬ ë²„íŠ¼ê³¼ ë‹¤ë¥¼ ê²½ìš° í•˜ì´ë¼ì´íŠ¸ ì œê±°
        if (currentHighlightedButton && currentHighlightedButton !== button) {
            currentHighlightedButton.classList.remove('highlight');
        }
        // ìƒˆë¡œìš´ ë²„íŠ¼ì— í•˜ì´ë¼ì´íŠ¸ ì¶”ê°€
        if (button) {
            button.classList.add('highlight');
            currentHighlightedButton = button;
        }
    }

    function handlePinchClick(button, isPinch) {
        if (isPinch && !pinchDetected) {
            pinchDetected = true;
            if (button) {
                button.click();
                // ëª¨ë“  ë²„íŠ¼ì˜ í•˜ì´ë¼ì´íŠ¸ ìŠ¤íƒ€ì¼ ì´ˆê¸°í™”
                allButtons.forEach(btn => {
                    btn.classList.remove('highlight');
                });
                
                // í´ë¦­ëœ ë²„íŠ¼ì—ë§Œ ë…¸ë€ìƒ‰ í…Œë‘ë¦¬ ì¶”ê°€
                button.style.border = '3px solid #ffc107';
                
                // í•€ì¹˜ í´ë¦­ì´ ëë‚œ í›„ í•˜ì´ë¼ì´íŠ¸ í´ë˜ìŠ¤ë¥¼ ë‹¤ì‹œ ì¶”ê°€í•˜ì—¬ ì •ìƒ ìƒíƒœë¡œ ë³µêµ¬
                setTimeout(() => {
                    highlightButton(currentHighlightedButton);
                    button.style.border = 'none'; // ë…¸ë€ìƒ‰ í…Œë‘ë¦¬ ì œê±°
                }, 200);
            }
        } else if (!isPinch) {
            pinchDetected = false;
        }
    }
    
    // ----------------------------------------------------
    // *** íƒ€ì´ë¨¸ ë° ë‹¨ìœ„ ë³€í™˜ê¸° ê´€ë ¨ ì½”ë“œ ***
    // ----------------------------------------------------
    let timerInterval;
    let totalSeconds = 0;

    function startTimer() {
        const minutes = parseInt(document.getElementById('minutes').value) || 0;
        const seconds = parseInt(document.getElementById('seconds').value) || 0;
        totalSeconds = minutes * 60 + seconds;
        if (totalSeconds <= 0) {
            alert("ìœ íš¨í•œ ì‹œê°„ì„ ì…ë ¥í•˜ì„¸ìš”.");
            return;
        }
        clearInterval(timerInterval);
        timerInterval = setInterval(updateTimer, 1000);
    }

    function updateTimer() {
        if (totalSeconds <= 0) {
            clearInterval(timerInterval);
            document.getElementById('timer-display').innerText = "ì‹œê°„ ì´ˆê³¼!";
            alert("íƒ€ì´ë¨¸ê°€ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!");
            return;
        }
        totalSeconds--;
        let min = Math.floor(totalSeconds / 60);
        let sec = totalSeconds % 60;
        document.getElementById('timer-display').innerText = 
            `${String(min).padStart(2, '0')}:${String(sec).padStart(2, '0')}`;
    }

    function stopTimer() {
        clearInterval(timerInterval);
    }

    function resetTimer() {
        clearInterval(timerInterval);
        totalSeconds = 0;
        document.getElementById('timer-display').innerText = "00:00";
        document.getElementById('minutes').value = '';
        document.getElementById('seconds').value = '';
    }

    function convertTemperature(type) {
        const celsiusInput = document.getElementById('celsius-input');
        const tempResult = document.getElementById('temp-result');
        const value = parseFloat(celsiusInput.value);
        if (isNaN(value)) {
            tempResult.innerText = "ìœ íš¨í•œ ìˆ«ìë¥¼ ì…ë ¥í•˜ì„¸ìš”.";
            return;
        }
        let result;
        if (type === 'celsius') {
            result = (value * 1.8 + 32).toFixed(2);
            tempResult.innerText = `í™”ì”¨: ${result} Â°F`;
        } else if (type === 'fahrenheit') {
            result = ((value - 32) / 1.8).toFixed(2);
            tempResult.innerText = `ì„­ì”¨: ${result} Â°C`;
        }
    }
</script>

</body>
</html>