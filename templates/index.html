<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì œìŠ¤ì²˜ ë ˆì‹œí”¼ë¶</title>
    <style>
        body {
            display: flex;
            margin: 0;
            font-family: Arial, sans-serif;
            height: 100vh;
            background-color: #f4f4f4;
        }
        .main-container {
            display: flex;
            width: 100%;
        }
        .recipe-list-area {
            flex: 1;
            background-color: #ffffff;
            padding: 20px;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            overflow-y: auto;
        }
        .recipe-content-area {
            flex: 1;
            background-color: #fff;
            padding: 20px;
            overflow-y: auto;
        }
        .side-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            background-color: #e9ecef;
        }
        .timer-container, .tool-container {
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin: 10px;
            border-radius: 8px;
        }
        .timer-container {
            background-color: #ffffff;
            flex: 1;
        }
        .tool-container {
            background-color: #ffffff;
            flex: 1;
        }
        h2 {
            color: #333;
            border-bottom: 2px solid #ccc;
            padding-bottom: 10px;
        }
        .recipe-list ul {
            list-style-type: none;
            padding: 0;
        }
        .recipe-list li {
            padding: 10px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            font-weight: bold;
        }
        .recipe-list li:hover {
            background-color: #f0f0f0;
        }
        .recipe-item {
            display: none;
        }
        .recipe-item.active {
            display: block;
        }
        /* ë‹¨ê³„ë³„ ë ˆì‹œí”¼ ìŠ¤íƒ€ì¼ */
        .recipe-step {
            display: none;
            border: 1px solid #e0e0e0;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
        }
        .recipe-step.active-step {
            display: block;
        }
        .step-navigation {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }

        .timer-display {
            font-size: 3em;
            text-align: center;
            margin: 20px 0;
            color: #555;
        }
        .timer-buttons {
            text-align: center;
        }
        .timer-buttons button, .convert-button, .step-navigation button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background-color: #007bff;
            color: white;
            transition: border 0.2s;
        }
        .timer-buttons button:hover, .convert-button:hover, .step-navigation button:hover {
            background-color: #0056b3;
        }
        input, select {
            padding: 8px;
            margin: 5px;
            border-radius: 4px;
            border: 1px solid #ccc;
            width: calc(100% - 10px);
        }
        .highlight {
            border: 3px solid #28a745 !important;
        }
        #finger-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
        }
    </style>
</head>
<body>

<div class="main-container">

    <div class="recipe-list-area">
        <h2>ë ˆì‹œí”¼ ëª©ë¡</h2>
        <div class="recipe-list">
            <ul>
                <li onclick="showRecipe('chicken')">ë§¤ì½¤í•œ ë‹­ë³¶ìŒíƒ• ğŸŒ¶ï¸</li>
                <li onclick="showRecipe('pasta')">ì‰¬ìš´ í¬ë¦¼ íŒŒìŠ¤íƒ€ ğŸ</li>
                <li onclick="showRecipe('curry')">ê°„ë‹¨ ì¹´ë ˆë¼ì´ìŠ¤ ğŸ›</li>
            </ul>
        </div>
    </div>

    <div class="recipe-content-area">
        <div id="recipe-chicken" class="recipe-item active">
            <h3>ë§¤ì½¤í•œ ë‹­ë³¶ìŒíƒ• ë ˆì‹œí”¼ ğŸŒ¶ï¸</h3>
            <p><strong>ì¬ë£Œ:</strong> ë‹­ í•œ ë§ˆë¦¬, ê°ì 2ê°œ, ì–‘íŒŒ 1ê°œ, ë‹¹ê·¼ 1ê°œ, ê³ ì¶§ê°€ë£¨, ê°„ì¥, ì„¤íƒ•, ë§ˆëŠ˜</p>
            <div id="chicken-step-1" class="recipe-step active-step">
                <h4>ë‹¨ê³„ 1: ë‹­ ì†ì§ˆ</h4>
                <p>ë‹­ì„ ê¹¨ë—ì´ ì”»ì–´ í•œì… í¬ê¸°ë¡œ ìë¥¸ë‹¤.</p>
                <img src="/static/images/chicken_soup_1.png" alt="ë‹­ ì†ì§ˆ ì´ë¯¸ì§€" style="width:100%;">
            </div>
            <div id="chicken-step-2" class="recipe-step">
                <h4>ë‹¨ê³„ 2: ì¬ë£Œ ë„£ê³  ë“ì´ê¸°</h4>
                <p>ëƒ„ë¹„ì— ë¬¼ì„ ë„£ê³  ì†ì§ˆí•œ ë‹­ê³¼ ê°ì, ë‹¹ê·¼ì„ ë„£ê³  ë“ì¸ë‹¤.</p>
                <img src="/static/images/chicken_soup_2.png" alt="ì¬ë£Œ ë„£ê³  ë“ì´ëŠ” ì´ë¯¸ì§€" style="width:100%;">
            </div>
            <div id="chicken-step-3" class="recipe-step" data-minutes="20">
                <h4>ë‹¨ê³„ 3: ì–‘ë…ì¥ ì¶”ê°€</h4>
                <p>ê³ ì¶§ê°€ë£¨, ê°„ì¥, ì„¤íƒ•, ë‹¤ì§„ ë§ˆëŠ˜ë¡œ ë§Œë“  ì–‘ë…ì¥ì„ ë„£ê³  ì¤‘ë¶ˆì—ì„œ 20ë¶„ê°„ ë“ì¸ë‹¤.</p>
                <img src="/static/images/chicken_soup_3.png" alt="ì–‘ë…ì¥ ì¶”ê°€ ì´ë¯¸ì§€" style="width:100%;">
            </div>
            <div id="chicken-step-4" class="recipe-step" data-minutes="5"> <h4>ë‹¨ê³„ 4: ì–‘íŒŒ ë„£ê³  ë§ˆë¬´ë¦¬</h4>
                <p>ë§ˆì§€ë§‰ìœ¼ë¡œ ì–‘íŒŒë¥¼ ë„£ê³  5ë¶„ ë” ë“ì´ë©´ ì™„ì„±!</p>
                <img src="/static/images/chicken_soup_4.png" alt="ì™„ì„±ëœ ë‹­ë³¶ìŒíƒ• ì´ë¯¸ì§€" style="width:100%;">
            </div>
        </div>
        
        <div id="recipe-pasta" class="recipe-item">
            <h3>ì‰¬ìš´ í¬ë¦¼ íŒŒìŠ¤íƒ€ ë ˆì‹œí”¼ ğŸ</h3>
            <p><strong>ì¬ë£Œ:</strong> íŒŒìŠ¤íƒ€ ë©´ 200g, ìƒí¬ë¦¼ 200ml, ë² ì´ì»¨, ì–‘íŒŒ, ë§ˆëŠ˜</p>
            <div id="pasta-step-1" class="recipe-step active-step" data-minutes="8">
                <h4>ë‹¨ê³„ 1: ë©´ ì‚¶ê¸°</h4>
                <p>ë“ëŠ” ë¬¼ì— ì†Œê¸ˆ ì•½ê°„ ë„£ê³  íŒŒìŠ¤íƒ€ ë©´ì„ ì‚¶ëŠ”ë‹¤. (ì•½ 8ë¶„)</p>
                <img src="/static/images/pasta_1.png" alt="íŒŒìŠ¤íƒ€ ë©´ ì‚¶ëŠ” ì´ë¯¸ì§€" style="width:100%;">
            </div>
            <div id="pasta-step-2" class="recipe-step">
                <h4>ë‹¨ê³„ 2: ì¬ë£Œ ë³¶ê¸°</h4>
                <p>íŒ¬ì— ë² ì´ì»¨ê³¼ ì–‘íŒŒ, ë§ˆëŠ˜ì„ ë³¶ëŠ”ë‹¤.</p>
                <img src="/static/images/pasta_2.png" alt="ì¬ë£Œ ë³¶ëŠ” ì´ë¯¸ì§€" style="width:100%;">
            </div>
            <div id="pasta-step-3" class="recipe-step">
                <h4>ë‹¨ê³„ 3: ìƒí¬ë¦¼ ë„£ê¸°</h4>
                <p>ìƒí¬ë¦¼ì„ ë¶“ê³  ë“ì´ë‹¤ê°€ ì‚¶ì€ ë©´ì„ ë„£ê³  ì„ëŠ”ë‹¤.</p>
                <img src="/static/images/pasta_3.png" alt="ìƒí¬ë¦¼ ë„£ëŠ” ì´ë¯¸ì§€" style="width:100%;">
            </div>
            <div id="pasta-step-4" class="recipe-step">
                <h4>ë‹¨ê³„ 4: ì™„ì„±!</h4>
                <p>ê°„ì„ ë§ì¶˜ í›„ ì ‘ì‹œì— ë‹´ì•„ ë§›ìˆê²Œ ë¨¹ëŠ”ë‹¤.</p>
                <img src="/static/images/pasta_4.png" alt="ì™„ì„±ëœ íŒŒìŠ¤íƒ€ ì´ë¯¸ì§€" style="width:100%;">
            </div>
        </div>
        
        <div id="recipe-curry" class="recipe-item">
            <h3>ê°„ë‹¨ ì¹´ë ˆë¼ì´ìŠ¤ ë ˆì‹œí”¼ ğŸ›</h3>
            <p><strong>ì¬ë£Œ:</strong> ì¹´ë ˆìš© ê³ ê¸°, ê°ì, ë‹¹ê·¼, ì–‘íŒŒ, ì¹´ë ˆ ê°€ë£¨</p>
            <div id="curry-step-1" class="recipe-step active-step">
                <h4>ë‹¨ê³„ 1: ì¬ë£Œ ì¤€ë¹„</h4>
                <p>ê³ ê¸°ì™€ ì±„ì†Œë¥¼ í•œì… í¬ê¸°ë¡œ ì¬ë‹¤.</p>
                <img src="/static/images/curry_1.png" alt="ì¬ë£Œ ì¤€ë¹„ ì´ë¯¸ì§€" style="width:100%;">
            </div>
            <div id="curry-step-2" class="recipe-step">
                <h4>ë‹¨ê³„ 2: ì¬ë£Œ ë³¶ê¸°</h4>
                <p>ëƒ„ë¹„ì— ê¸°ë¦„ì„ ë‘ë¥´ê³  ê³ ê¸°ì™€ ì±„ì†Œë¥¼ ë³¶ëŠ”ë‹¤.</p>
                <img src="/static/images/curry_2.png" alt="ì¬ë£Œ ë³¶ëŠ” ì´ë¯¸ì§€" style="width:100%;">
            </div>
            <div id="curry-step-3" class="recipe-step">
                <h4>ë‹¨ê³„ 3: ë¬¼ê³¼ ê°€ë£¨ ë„£ê¸°</h4>
                <p>ë¬¼ì„ ë„£ê³  ë“ì´ë‹¤ê°€ ì±„ì†Œê°€ ìµìœ¼ë©´ ì¹´ë ˆ ê°€ë£¨ë¥¼ ë„£ëŠ”ë‹¤.</p>
                <img src="/static/images/curry_3.png" alt="ì¹´ë ˆ ê°€ë£¨ ë„£ëŠ” ì´ë¯¸ì§€" style="width:100%;">
            </div>
            <div id="curry-step-4" class="recipe-step">
                <h4>ë‹¨ê³„ 4: ì™„ì„±!</h4>
                <p>ì˜ ì €ì–´ê°€ë©° ë“ì´ë‹¤ê°€ ê±¸ì­‰í•´ì§€ë©´ ë¶ˆì„ ëˆë‹¤.</p>
                <img src="/static/images/curry_4.png" alt="ì™„ì„±ëœ ì¹´ë ˆ ì´ë¯¸ì§€" style="width:100%;">
            </div>
        </div>

        <div class="step-navigation">
            <button id="prev-step-btn" onclick="prevStep()">ì´ì „</button>
            <button id="next-step-btn" onclick="nextStep()">ë‹¤ìŒ ë‹¨ê³„</button>
        </div>
    </div>

    <div class="side-area">

        <div class="timer-container">
            <h2>ìš”ë¦¬ íƒ€ì´ë¨¸</h2>
            <div class="timer-display" id="timer-display">00:00</div>
            <div class="timer-buttons">
                <button onclick="startTimer()">ì‹œì‘</button>
                <button onclick="stopTimer()">ì •ì§€</button>
                <button onclick="resetTimer()">ì´ˆê¸°í™”</button>
            </div>
            <input type="number" id="minutes" placeholder="ë¶„" style="width: calc(50% - 10px); float: left;">
            <input type="number" id="seconds" placeholder="ì´ˆ" style="width: calc(50% - 10px); float: right;">
        </div>

        <div class="tool-container">
            <h2>ë‹¨ìœ„ ë³€í™˜ê¸°</h2>
            <p>ì˜¨ë„ ë³€í™˜</p>
            <input type="number" id="celsius-input" placeholder="ì„­ì”¨ (Â°C)">
            <p>
                <button class="convert-button" onclick="convertTemperature('celsius')">í™”ì”¨ ë³€í™˜</button>
                <button class="convert-button" onclick="convertTemperature('fahrenheit')">ì„­ì”¨ ë³€í™˜</button>
            </p>
            <p id="temp-result" style="font-weight: bold;"></p>
        </div>
    </div>

</div>

<canvas id="finger-canvas"></canvas>

<script>
    // ----------------------------------------------------
    // *** ìº”ë²„ìŠ¤ì— ë¹¨ê°„ ì  í‘œì‹œ ê¸°ëŠ¥ ***
    // ----------------------------------------------------
    const canvas = document.getElementById('finger-canvas');
    const ctx = canvas.getContext('2d');

    function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    function drawFingerPoint(x, y) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.beginPath();
        ctx.arc(x, y, 10, 0, 2 * Math.PI);
        ctx.fillStyle = 'red';
        ctx.fill();
        ctx.lineWidth = 2;
        ctx.strokeStyle = '#fff';
        ctx.stroke();
    }

    // ----------------------------------------------------
    // *** ì œìŠ¤ì²˜ ì¸ì‹ ë° ë²„íŠ¼ ë§¤í•‘ ê´€ë ¨ ì½”ë“œ ***
    // ----------------------------------------------------
    let allButtons = [];
    let currentHighlightedButton = null;
    let pinchDetected = false;

    // ë‹¨ê³„ë³„ ë ˆì‹œí”¼ ì œì–´ë¥¼ ìœ„í•œ ë³€ìˆ˜
    let currentStepIndex = 0;
    let totalSteps = 0;

    // showRecipe í•¨ìˆ˜
    function showRecipe(recipeId) {
        const allRecipeItems = document.querySelectorAll('.recipe-item');
        allRecipeItems.forEach(item => {
            item.classList.remove('active');
        });
        document.getElementById('recipe-' + recipeId).classList.add('active');
        
        // ìƒˆë¡œìš´ ë‹¨ê³„ ì „í™˜ ë¡œì§
        currentStepIndex = 0;
        const currentRecipe = document.getElementById('recipe-' + recipeId);
        const steps = currentRecipe.querySelectorAll('.recipe-step');
        totalSteps = steps.length;
        
        steps.forEach(step => step.classList.remove('active-step'));
        steps[0].classList.add('active-step');
        
        // ì²« ë‹¨ê³„ì˜ íƒ€ì´ë¨¸ ì„¤ì •
        setTimerFromStep(steps[0]);
        
        // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
        updateNavigationButtons();
    }
    
    // ë‹¤ìŒ ë‹¨ê³„ë¡œ ì´ë™í•˜ëŠ” í•¨ìˆ˜
    function nextStep() {
        const currentRecipe = document.querySelector('.recipe-item.active');
        const steps = currentRecipe.querySelectorAll('.recipe-step');
    
        if (currentStepIndex < totalSteps - 1) {
            steps[currentStepIndex].classList.remove('active-step');
            currentStepIndex++;
            steps[currentStepIndex].classList.add('active-step');
            
            // ë³€ê²½ëœ ë¶€ë¶„: ë‹¤ìŒ ë‹¨ê³„ì˜ ì‹œê°„ì„ ìë™ìœ¼ë¡œ ì„¤ì •
            setTimerFromStep(steps[currentStepIndex]);
        }
        updateNavigationButtons();
    }
    
    // ì´ì „ ë‹¨ê³„ë¡œ ì´ë™í•˜ëŠ” í•¨ìˆ˜
    function prevStep() {
        const currentRecipe = document.querySelector('.recipe-item.active');
        const steps = currentRecipe.querySelectorAll('.recipe-step');
    
        if (currentStepIndex > 0) {
            steps[currentStepIndex].classList.remove('active-step');
            currentStepIndex--;
            steps[currentStepIndex].classList.add('active-step');
            
            // ë³€ê²½ëœ ë¶€ë¶„: ì´ì „ ë‹¨ê³„ì˜ ì‹œê°„ì„ ìë™ìœ¼ë¡œ ì„¤ì •
            setTimerFromStep(steps[currentStepIndex]);
        }
        updateNavigationButtons();
    }
    
    // ìƒˆë¡œ ì¶”ê°€ëœ í•¨ìˆ˜: ë‹¨ê³„ì— ë”°ë¼ íƒ€ì´ë¨¸ë¥¼ ì„¤ì •
    function setTimerFromStep(stepElement) {
        const minutesInput = document.getElementById('minutes');
        const secondsInput = document.getElementById('seconds');
        
        // data-* ì†ì„±ì—ì„œ ê°’ ì½ê¸°
        const minutes = stepElement.getAttribute('data-minutes') || '';
        const seconds = stepElement.getAttribute('data-seconds') || '';
        
        minutesInput.value = minutes;
        secondsInput.value = seconds;

        // íƒ€ì´ë¨¸ ë””ìŠ¤í”Œë ˆì´ ì—…ë°ì´íŠ¸
        let minDisplay = String(minutes).padStart(2, '0');
        let secDisplay = String(seconds).padStart(2, '0');
        document.getElementById('timer-display').innerText = `${minDisplay}:${secDisplay}`;
        
        clearInterval(timerInterval); // íƒ€ì´ë¨¸ê°€ ì‹¤í–‰ ì¤‘ì´ë©´ ì¤‘ì§€
        totalSeconds = parseInt(minutes) * 60 + parseInt(seconds); // ì´ ì‹œê°„ ì¬ì„¤ì •
    }
    
    // ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ì˜ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” í•¨ìˆ˜
    function updateNavigationButtons() {
        const nextBtn = document.getElementById('next-step-btn');
        const prevBtn = document.getElementById('prev-step-btn');
    
        prevBtn.style.display = (currentStepIndex > 0) ? 'inline-block' : 'none';
        
        if (currentStepIndex === totalSteps - 1) {
            nextBtn.innerText = 'ë ˆì‹œí”¼ ì™„ë£Œ!';
        } else {
            nextBtn.innerText = 'ë‹¤ìŒ ë‹¨ê³„';
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        showRecipe('chicken');
        allButtons = Array.from(document.querySelectorAll('.timer-buttons button, .convert-button, .recipe-list li, #next-step-btn, #prev-step-btn'));
        
        setInterval(fetchFingerPosition, 100);
    });

    function fetchFingerPosition() {
        fetch('/get_finger_pos')
            .then(response => response.json())
            .then(data => {
                const fingerX = data.x * window.innerWidth;
                const fingerY = data.y * window.innerHeight;
                const isPinch = data.isPinch;

                if (!isNaN(fingerX) && !isNaN(fingerY)) {
                    drawFingerPoint(fingerX, fingerY);
                    const closestButton = findClosestButton(fingerX, fingerY);
                    highlightButton(closestButton);
                    handlePinchClick(closestButton, isPinch);
                }
            })
            .catch(error => console.error('Error fetching data:', error));
    }

    function findClosestButton(x, y) {
        let closestBtn = null;
        let minDistance = Infinity;

        allButtons.forEach(btn => {
            const rect = btn.getBoundingClientRect();
            const btnX = rect.left + rect.width / 2;
            const btnY = rect.top + rect.height / 2;
            
            const distance = Math.sqrt(Math.pow(btnX - x, 2) + Math.pow(btnY - y, 2));

            if (distance < minDistance) {
                minDistance = distance;
                closestBtn = btn;
            }
        });
        return closestBtn;
    }

    function highlightButton(button) {
        if (currentHighlightedButton && currentHighlightedButton !== button) {
            currentHighlightedButton.classList.remove('highlight');
        }
        if (button) {
            button.classList.add('highlight');
            currentHighlightedButton = button;
        }
    }

    function handlePinchClick(button, isPinch) {
        if (isPinch && !pinchDetected) {
            pinchDetected = true;
            if (button) {
                button.click();
                allButtons.forEach(btn => {
                    btn.classList.remove('highlight');
                });
                
                button.style.border = '3px solid #ffc107';
                
                setTimeout(() => {
                    highlightButton(currentHighlightedButton);
                    button.style.border = ''; // ë…¸ë€ìƒ‰ í…Œë‘ë¦¬ ì œê±°
                }, 200);
            }
        } else if (!isPinch) {
            pinchDetected = false;
        }
    }
    
    // ----------------------------------------------------
    // *** íƒ€ì´ë¨¸ ë° ë‹¨ìœ„ ë³€í™˜ê¸° ê´€ë ¨ ì½”ë“œ ***
    // ----------------------------------------------------
    let timerInterval;
    let totalSeconds = 0;

    function startTimer() {
        const minutes = parseInt(document.getElementById('minutes').value) || 0;
        const seconds = parseInt(document.getElementById('seconds').value) || 0;
        totalSeconds = minutes * 60 + seconds;
        if (totalSeconds <= 0) {
            alert("ìœ íš¨í•œ ì‹œê°„ì„ ì…ë ¥í•˜ì„¸ìš”.");
            return;
        }
        clearInterval(timerInterval);
        timerInterval = setInterval(updateTimer, 1000);
    }

    function updateTimer() {
        if (totalSeconds <= 0) {
            clearInterval(timerInterval);
            document.getElementById('timer-display').innerText = "ì‹œê°„ ì´ˆê³¼!";
            alert("íƒ€ì´ë¨¸ê°€ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!");
            return;
        }
        totalSeconds--;
        let min = Math.floor(totalSeconds / 60);
        let sec = totalSeconds % 60;
        document.getElementById('timer-display').innerText = 
            `${String(min).padStart(2, '0')}:${String(sec).padStart(2, '0')}`;
    }

    function stopTimer() {
        clearInterval(timerInterval);
    }

    function resetTimer() {
        clearInterval(timerInterval);
        totalSeconds = 0;
        document.getElementById('timer-display').innerText = "00:00";
        document.getElementById('minutes').value = '';
        document.getElementById('seconds').value = '';
    }

    function convertTemperature(type) {
        const celsiusInput = document.getElementById('celsius-input');
        const tempResult = document.getElementById('temp-result');
        const value = parseFloat(celsiusInput.value);
        if (isNaN(value)) {
            tempResult.innerText = "ìœ íš¨í•œ ìˆ«ìë¥¼ ì…ë ¥í•˜ì„¸ìš”.";
            return;
        }
        let result;
        if (type === 'celsius') {
            result = (value * 1.8 + 32).toFixed(2);
            tempResult.innerText = `í™”ì”¨: ${result} Â°F`;
        } else if (type === 'fahrenheit') {
            result = ((value - 32) / 1.8).toFixed(2);
            tempResult.innerText = `ì„­ì”¨: ${result} Â°C`;
        }
    }
</script>

</body>
</html>